import{f as a,I as e,j as l,k as t,P as s,Q as n,V as u,l as c,m as i,N as o,r,O as v,o as f,d,e as p,t as g,g as m,F as y,s as h,q as x,x as b}from"./vendor.e1762ece.js";import{_ as k}from"./playlist-item.vue_vue_type_style_index_0_lang.e8a96a32.js";import{g as w,d as I}from"./playlist.332883b4.js";import{u as j,g as _}from"./index.299bc7d5.js";const O={class:"sticky flex flex-col items-center overflow-hidden w-full transform top-16 mt-2",id:"playlist-info"},z={alt:"封面",class:"h-48 w-48 object-cover align-bottom"},E={class:"text-center w-full"},P={class:"text-2xl mt-2 truncate px-2"},U={class:"text-sm font-light mt-1 overflow-elision-2 px-2"},F={class:"w-full z-10 pt-4",id:"playlist-content"},S={class:"pt-10 relative bg-gray-900"},T={class:"space-y-2 pb-2"},C={class:"my-5 w-full text-center font-normal text-sm text-gray-400"},M={key:1,class:"w-full text-lg h-full flex items-center justify-center"};var N=a({async setup(a){const N=j(),R=e();l((()=>{la()})),t((()=>{ta()})),s((()=>{la()})),n((()=>{ta(),L.value=!1})),u((()=>{V.value=!1}));const $=c(null),q=c([]),A=new IntersectionObserver((a=>{a.forEach((a=>{switch(a.target.getAttribute("data-flag")){case"SUF":a.isIntersecting&&(H.value.length?B.value=B.value.concat(H.value.splice(0,20)):!J.value&&async function(){J.value=!0;const a=D.value.slice(Q.value,Q.value+20).map((a=>a.id)).join(",");try{const{data:{songs:e}}=await _(a);e&&(B.value=B.value.concat(e),Q.value+=20)}catch(e){console.log(e)}finally{J.value=!1}}());break;case"PRE":L.value=!a.isIntersecting}}))}),{root:$.value,threshold:[0,1]}),L=c(!1),Q=c(0),V=c(!0),B=c([]),D=c([]),G=c({}),H=c([]),J=c(!1),K=i((()=>N.state.player)),W=i((()=>G.value.id===K.value.listId)),X=i((()=>Number(R.params.id))),Y=i((()=>H.value.length||Q.value<D.value.length));try{if(X.value){const{data:a}=await o(w(X.value));G.value=a.playlist,D.value=G.value.trackIds,H.value=B.value.concat(G.value.tracks),Q.value=H.value.length,H.value.length>10?B.value=H.value.splice(0,10):B.value=H.value}else{const{data:a}=await o(I());B.value=a.data.dailySongs,G.value={id:0,name:"每日推荐",description:`${N.state.userInfo.nickname}的每日专属推荐歌曲`,coverImgUrl:B.value[0].al.picUrl}}}catch(sa){V.value=!1}function Z(){aa(),K.value._playTrack()}function aa(){K.value.listId!==G.value.id&&(K.value.trackList=B.value.concat(H.value),K.value.list=D.value,K.value.listId=G.value.id)}function ea(a){q.value.push(a)}function la(){q.value.length&&q.value.forEach((a=>{A.observe(a)}))}function ta(){q.value.length&&(q.value.forEach((a=>{A.unobserve(a)})),A.disconnect())}return(a,e)=>{const l=r("svg-icon"),t=v("img");return V.value?(f(),d("div",{key:0,class:"playlist-wrapper w-full h-full overflow-y-scroll overflow-x-hidden relative",ref:$},[p("header",{class:["head-menu flex text-base h-14 sticky left-0 top-0 z-20 px-2 pt-4 m-0",L.value?"bg-gray-900":""]},[p(l,{name:"back",onClick:e[1]||(e[1]=e=>a.$router.go(-1))}),p("h2",{class:["flex-1 text-center mx-5 truncate opacity-0",{"opacity-100":L.value}]},g(G.value.name),3),p(l,{name:"more"})],2),p("figure",O,[m(p("img",z,null,512),[[t,G.value.coverImgUrl+"?param=200y200"]]),p("figcaption",E,[p("h1",P,g(G.value.name),1),p("p",U,g(G.value.description),1)])]),p("div",F,[p("div",{class:["btn-divider text-center h-6 sticky z-30 left-0 right-0 top-14 flex justify-center",{"bg-gray-900":L.value}]},[p("button",{class:"btn absolute -bottom-6 z-20 shadow-sm",type:"button",onClick:Z},"播放")],2),p("div",S,[p("span",{class:"absolute -top-20 z-0",ref:ea,"data-flag":"PRE"}),p("ul",T,[(f(!0),d(y,null,h(B.value,((a,e)=>{var l,t;return f(),d(k,{track:a,"is-playing":x(W)&&a.id===(null==(t=null==(l=x(K))?void 0:l.currentTrack)?void 0:t.id),onOnPlay:a=>function(a){aa(),K.value._playTrack(a)}(e),onOnMenu:e=>{a.id}},null,8,["track","is-playing","onOnPlay","onOnMenu"])})),256))])]),m(p("div",C,[p("span",{ref:ea,"data-flag":"SUF"},"loading...")],512),[[b,x(Y)]])])],512)):(f(),d("div",M,"加载失败~"))}}});export{N as default};
