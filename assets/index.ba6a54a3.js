import{f as e,U as l,M as a,I as t,l as s,O as u,o,d as n,q as r,g as i,v as c,e as p,z as v,R as f,F as d,s as m,t as x}from"./vendor.e1762ece.js";import{s as y}from"./others.10696936.js";import{L as h}from"./index.d.0906a426.js";import{u as g,l as b,c as w}from"./index.299bc7d5.js";const k={class:"flex flex-col text-lg text-white bg-gray-900 pt-4 px-2 w-auto h-full relative"},U={key:0,class:"h-full flex flex-col justify-center"},C={key:1,class:"h-full flex flex-col"},A=p("h2",null,"昵称登录",-1),E=p("label",{for:"keyword"},null,-1),N={class:"mt-4 space-y-2 overflow-y-auto flex-1 pb-4 overflow-x-hidden"},T={alt:"头像",class:"h-full"},j={class:"ml-3 flex-1 transition-all"},O={class:"text-xl truncate"},I={class:"text-sm text-gray-400 mt-1 overflow-elision-3"},M={key:0,class:"w-full text-center text-sm text-gray-400 my-4"},R=p("span",null,"加载中...",-1),z={key:1,class:"w-full text-center text-sm text-gray-400 my-4"};var L=e({setup(e){l((()=>{L.state.loginType&&-1!==L.state.loginType&&P.replace("/")}));const L=g(),P=a(),S=Number(t().params.type),V=s(""),D=s(!1),F=s(!1),Z=s(0),$=s(-1),_=s(""),q=s(""),G=s([]),K=s(-1);function Y(){G.value.length&&(L.commit("UPDATE_USERINFO",G.value[$.value]),L.commit("UPDATE_LOGINTYPE",K.value),L.dispatch("getLikelist"),P.replace("/library"))}async function B(){if(!_.value&&!q.value)return;K.value=h.ACCOUNT;if(/^(?:(?:\+|00)86)?1(?:(?:3[\d])|(?:4[5-79])|(?:5[0-35-9])|(?:6[5-7])|(?:7[0-8])|(?:8[\d])|(?:9[189]))\d{8}$/.test(_.value)){const{data:e}=await b({phone:_.value,password:q.value});G.value.push(e.profile),$.value=0,Y()}else if(/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(_.value)){const{data:e}=await w({email:_.value,password:q.value});G.value.push(e.profile),$.value=0,Y()}else console.log("无效账号名")}async function H(e=!1){if(V.value){e||(Z.value=0,G.value=[]),D.value=!0;try{const{data:e}=await y({keywords:V.value,limit:10,offset:Z.value,type:1002});e.result.userprofiles&&(G.value=G.value.concat(e.result.userprofiles),Z.value+=10,F.value=e.result.hasMore)}catch(l){console.log(l)}finally{D.value=!1,K.value=h.USERNAME}}}return(e,l)=>{const a=u("img");return o(),n("div",k,[r(S)===r(h).ACCOUNT?(o(),n("div",U,[i(p("input",{"onUpdate:modelValue":l[1]||(l[1]=e=>_.value=e),class:"w-full mt-4 px-4 py-2 rounded text-base font-medium text-black",type:"text",placeholder:"输入邮箱或者手机号"},null,512),[[c,_.value]]),i(p("input",{"onUpdate:modelValue":l[2]||(l[2]=e=>q.value=e),class:"w-full mt-4 px-4 py-2 rounded text-base font-medium text-black",type:"password",placeholder:"密码"},null,512),[[c,q.value]]),p("button",{class:"btn-primary mt-8",type:"button",onClick:B},"登录")])):v("",!0),r(S)===r(h).USERNAME?(o(),n("div",C,[A,p("fieldset",null,[E,i(p("input",{"onUpdate:modelValue":l[3]||(l[3]=e=>V.value=e),class:"w-full mt-4 px-4 py-2 rounded text-base font-medium text-black",type:"text",name:"username",id:"username",placeholder:"请输入您的网易云用户名",onKeypress:l[4]||(l[4]=f((e=>H()),["enter"]))},null,544),[[c,V.value]])]),p("ul",N,[(o(!0),n(d,null,m(G.value,((e,l)=>(o(),n("li",{key:e.userId,class:["relative h-24 flex transition-all rounded-sm items-center self-start bg-opacity-30 duration-300",{"transform origin-left -translate-x-24":l===$.value}],onClick:e=>$.value=l},[i(p("img",T,null,512),[[a,e.avatarUrl]]),p("div",j,[p("p",O,x(e.nickname),1),p("p",I,x(e.signature),1)]),p("span",{class:"btn-primary absolute -right-20",onClick:Y}," 确认 ")],10,["onClick"])))),128)),D.value?(o(),n("li",M,[R])):F.value?(o(),n("li",z,[p("span",{onClick:l[5]||(l[5]=e=>H(!0))},"加载更多")])):v("",!0)])])):v("",!0)])}}});export{L as default};
